steps:
  build-and-push:
    image: woodpeckerci/plugin-docker-buildx:6.0.1
    settings:
      repo: ["${CI_REPO_OWNER%%io}/${CI_REPO_NAME}", "oci.redpencil.io/${CI_REPO_OWNER%%io}/${CI_REPO_NAME}"]
      tags: "feature-${CI_COMMIT_BRANCH##feature/}"
      mirror: "https://docker-registry-mirror.redpencil.io"
      logins:
        - registry: "https://index.docker.io/v1/"
          username:
            from_secret: docker_username
          password:
            from_secret: docker_password
when:
  - event: push
    branch: [feature/*]
